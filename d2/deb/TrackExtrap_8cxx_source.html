<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Detectors/MUON/MCH/Tracking/src/TrackExtrap.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d2/deb/TrackExtrap_8cxx_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TrackExtrap.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d2/deb/TrackExtrap_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d9c/TrackExtrap_8h.html">TrackExtrap.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;TGeoGlobalMagField.h&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;TMath.h&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;TMatrixD.h&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;FairMQLogger.h&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d4b/TrackParam_8h.html">TrackParam.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">namespace </span>mch</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keywordtype">bool</span> TrackExtrap::sExtrapV2 = <span class="keyword">false</span>;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keywordtype">double</span> TrackExtrap::sSimpleBValue = 0.;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keywordtype">bool</span> TrackExtrap::sFieldON = <span class="keyword">false</span>;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;std::size_t TrackExtrap::sNCallExtrapToZCov = 0;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;std::size_t TrackExtrap::sNCallField = 0;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a3820068e4ae7e7b3c7a0a668d40e21e1">   38</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a3820068e4ae7e7b3c7a0a668d40e21e1">TrackExtrap::setField</a>()</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[3] = {50., 50., SSimpleBPosition};</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>[3] = {0., 0., 0.};</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  TGeoGlobalMagField::Instance()-&gt;Field(x, b);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  sSimpleBValue = b[0];</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  sFieldON = (TMath::Abs(sSimpleBValue) &gt; 1.e-10) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Track extrapolation with magnetic field &quot;</span> &lt;&lt; (sFieldON ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#acf3acff66b783f10a36a67d8c36f1bcd">   51</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#acf3acff66b783f10a36a67d8c36f1bcd">TrackExtrap::getImpactParamFromBendingMomentum</a>(<span class="keywordtype">double</span> bendingMomentum)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;{</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> correctionFactor = 1.1; <span class="comment">// impact parameter is 10% underestimated</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">if</span> (bendingMomentum == 0.) {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">return</span> 1.e10;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordflow">return</span> correctionFactor * (-0.0003 * sSimpleBValue * SSimpleBLength * SSimpleBPosition / bendingMomentum);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6e00e7ed1cba587512308463c62edd52">   65</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6e00e7ed1cba587512308463c62edd52">TrackExtrap::getBendingMomentumFromImpactParam</a>(<span class="keywordtype">double</span> impactParam)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> correctionFactor = 1.1; <span class="comment">// bending momentum is 10% underestimated</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">if</span> (impactParam == 0.) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">return</span> 1.e10;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span> (sFieldON) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">return</span> correctionFactor * (-0.0003 * sSimpleBValue * SSimpleBLength * SSimpleBPosition / impactParam);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">return</span> SMostProbBendingMomentum;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#adaa09ecf68637a4523743f5fb2aca2c8">   83</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#adaa09ecf68637a4523743f5fb2aca2c8">TrackExtrap::linearExtrapToZ</a>(<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam, <span class="keywordtype">double</span> zEnd)</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;{</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">if</span> (trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>() == zEnd) {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">return</span>; <span class="comment">// nothing to be done if same z</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">// Compute track parameters</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordtype">double</span> dZ = zEnd - trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>();</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">setNonBendingCoor</a>(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a737deb142ad46bc08af58b4963a8f527">getNonBendingCoor</a>() + trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>() * dZ);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">setBendingCoor</a>(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a5cb1a7806fe3bbe43133b9e7472bd441">getBendingCoor</a>() + trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>() * dZ);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a13423cb6b35af04303a6b18bae9f597b">setZ</a>(zEnd);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6a38a16a9b79f77e515a8c3b76eebdd7">  100</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6a38a16a9b79f77e515a8c3b76eebdd7">TrackExtrap::linearExtrapToZCov</a>(<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam, <span class="keywordtype">double</span> zEnd, <span class="keywordtype">bool</span> updatePropagator)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">if</span> (trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>() == zEnd) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span>; <span class="comment">// nothing to be done if same z</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">// No need to propagate the covariance matrix if it does not exist</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">if</span> (!trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3a666dd94c87147dbde312166c9ba6a0">hasCovariances</a>()) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;Covariance matrix does not exist&quot;</span>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// Extrapolate linearly track parameters to &quot;zEnd&quot;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#adaa09ecf68637a4523743f5fb2aca2c8">linearExtrapToZ</a>(trackParam, zEnd);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// Compute track parameters</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordtype">double</span> dZ = zEnd - trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>();</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">setNonBendingCoor</a>(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a737deb142ad46bc08af58b4963a8f527">getNonBendingCoor</a>() + trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>() * dZ);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">setBendingCoor</a>(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a5cb1a7806fe3bbe43133b9e7472bd441">getBendingCoor</a>() + trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>() * dZ);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a13423cb6b35af04303a6b18bae9f597b">setZ</a>(zEnd);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// Calculate the jacobian related to the track parameters linear extrapolation to &quot;zEnd&quot;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  TMatrixD jacob(5, 5);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  jacob.UnitMatrix();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  jacob(0, 1) = dZ;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  jacob(2, 3) = dZ;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// Extrapolate track parameter covariances to &quot;zEnd&quot;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  TMatrixD tmp(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ab125dbb11ccb6f40a01a34691741cb70">getCovariances</a>(), TMatrixD::kMultTranspose, jacob);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  TMatrixD tmp2(jacob, TMatrixD::kMult, tmp);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">setCovariances</a>(tmp2);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">// Update the propagator if required</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">if</span> (updatePropagator) {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#acc74ea7901f760fb2815a62b28c8fdc7">updatePropagator</a>(jacob);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a8f1273bfdd614c2336509e4ec4395d62">  141</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a8f1273bfdd614c2336509e4ec4395d62">TrackExtrap::extrapToZ</a>(<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam, <span class="keywordtype">double</span> zEnd)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (!sFieldON) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#adaa09ecf68637a4523743f5fb2aca2c8">linearExtrapToZ</a>(trackParam, zEnd);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sExtrapV2) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">return</span> extrapToZRungekuttaV2(trackParam, zEnd);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">return</span> extrapToZRungekutta(trackParam, zEnd);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">  156</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">TrackExtrap::extrapToZCov</a>(<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam, <span class="keywordtype">double</span> zEnd, <span class="keywordtype">bool</span> updatePropagator)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;{</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  ++sNCallExtrapToZCov;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">if</span> (trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>() == zEnd) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// nothing to be done if same z</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">if</span> (!sFieldON) { <span class="comment">// linear extrapolation if no magnetic field</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6a38a16a9b79f77e515a8c3b76eebdd7">linearExtrapToZCov</a>(trackParam, zEnd, updatePropagator);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">// No need to propagate the covariance matrix if it does not exist</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordflow">if</span> (!trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3a666dd94c87147dbde312166c9ba6a0">hasCovariances</a>()) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;Covariance matrix does not exist&quot;</span>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// Extrapolate track parameters to &quot;zEnd&quot;</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a8f1273bfdd614c2336509e4ec4395d62">extrapToZ</a>(trackParam, zEnd);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// Save the actual track parameters</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a> trackParamSave(*trackParam);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  TMatrixD paramSave(trackParamSave.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a54d02ff485fc6a60973d0fd9f51a5616">getParameters</a>());</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordtype">double</span> zBegin = trackParamSave.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">// Get reference to the parameter covariance matrix</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">const</span> TMatrixD&amp; kParamCov = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ab125dbb11ccb6f40a01a34691741cb70">getCovariances</a>();</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// Extrapolate track parameters to &quot;zEnd&quot;</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// Do not update the covariance matrix if the extrapolation failed</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a8f1273bfdd614c2336509e4ec4395d62">extrapToZ</a>(trackParam, zEnd)) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">// Get reference to the extrapolated parameters</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keyword">const</span> TMatrixD&amp; extrapParam = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a54d02ff485fc6a60973d0fd9f51a5616">getParameters</a>();</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">// Calculate the jacobian related to the track parameters extrapolation to &quot;zEnd&quot;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  TMatrixD jacob(5, 5);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  jacob.Zero();</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  TMatrixD dParam(5, 1);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordtype">double</span> direction[5] = {-1., -1., 1., 1., -1.};</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 5; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// Skip jacobian calculation for parameters with no associated error</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span> (kParamCov(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) &lt;= 0.) {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// Small variation of parameter i only</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 5; j++) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">if</span> (j == <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        dParam(j, 0) = TMath::Sqrt(kParamCov(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        dParam(j, 0) *= TMath::Sign(1., direction[j] * paramSave(j, 0)); <span class="comment">// variation always in the same direction</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        dParam(j, 0) = 0.;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// Set new parameters</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    trackParamSave.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aba28923af349ff2ec356d00c8b46dcb4">setParameters</a>(paramSave);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    trackParamSave.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a6dc7af2f47ff1263047e41a5ef9ddc7b">addParameters</a>(dParam);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    trackParamSave.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a13423cb6b35af04303a6b18bae9f597b">setZ</a>(zBegin);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// Extrapolate new track parameters to &quot;zEnd&quot;</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a8f1273bfdd614c2336509e4ec4395d62">extrapToZ</a>(&amp;trackParamSave, zEnd)) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;Bad covariance matrix&quot;</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// Calculate the jacobian</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    TMatrixD jacobji(trackParamSave.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a54d02ff485fc6a60973d0fd9f51a5616">getParameters</a>(), TMatrixD::kMinus, extrapParam);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    jacobji *= 1. / dParam(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, 0);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    jacob.SetSub(0, <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, jacobji);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">// Extrapolate track parameter covariances to &quot;zEnd&quot;</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  TMatrixD tmp(kParamCov, TMatrixD::kMultTranspose, jacob);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  TMatrixD tmp2(jacob, TMatrixD::kMult, tmp);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">setCovariances</a>(tmp2);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="comment">// Update the propagator if required</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">if</span> (updatePropagator) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#acc74ea7901f760fb2815a62b28c8fdc7">updatePropagator</a>(jacob);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;}</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">  248</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">TrackExtrap::getMCSAngle2</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a>, <span class="keywordtype">double</span> dZ, <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a98ac434677655cc8438bb72de2719f39">x0</a>)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordtype">double</span> bendingSlope = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>();</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">double</span> nonBendingSlope = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>();</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordtype">double</span> inverseTotalMomentum2 = param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a519bf955b6adb701214cf7bc8167598e">getInverseBendingMomentum</a>() * param.<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a519bf955b6adb701214cf7bc8167598e">getInverseBendingMomentum</a>() *</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                 (1.0 + bendingSlope * bendingSlope) /</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                 (1.0 + bendingSlope * bendingSlope + nonBendingSlope * nonBendingSlope);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">// Path length in the material</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">double</span> pathLength =</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    TMath::Abs(dZ) * TMath::Sqrt(1.0 + bendingSlope * bendingSlope + nonBendingSlope * nonBendingSlope);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// relativistic velocity</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordtype">double</span> velo = 1.;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// Angular dispersion square of the track (variance) in a plane perpendicular to the trajectory</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">double</span> theta02 = 0.0136 / velo * (1 + 0.038 * TMath::Log(pathLength / x0));</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">return</span> theta02 * theta02 * inverseTotalMomentum2 * pathLength / <a class="code" href="../../dc/da3/glcorearb_8h.html#a98ac434677655cc8438bb72de2719f39">x0</a>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">  269</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">TrackExtrap::addMCSEffect</a>(<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam, <span class="keywordtype">double</span> dZ, <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a98ac434677655cc8438bb72de2719f39">x0</a>)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;{</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordtype">double</span> bendingSlope = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">double</span> nonBendingSlope = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>();</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">double</span> inverseBendingMomentum = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a519bf955b6adb701214cf7bc8167598e">getInverseBendingMomentum</a>();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">double</span> inverseTotalMomentum2 = inverseBendingMomentum * inverseBendingMomentum * (1.0 + bendingSlope * bendingSlope) /</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                 (1.0 + bendingSlope * bendingSlope + nonBendingSlope * nonBendingSlope);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// Path length in the material</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordtype">double</span> signedPathLength = dZ * TMath::Sqrt(1.0 + bendingSlope * bendingSlope + nonBendingSlope * nonBendingSlope);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">double</span> pathLengthOverX0 = (x0 &gt; 0.) ? TMath::Abs(signedPathLength) / x0 : TMath::Abs(signedPathLength);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// relativistic velocity</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">double</span> velo = 1.;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// Angular dispersion square of the track (variance) in a plane perpendicular to the trajectory</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">double</span> theta02 = 0.0136 / velo * (1 + 0.038 * TMath::Log(pathLengthOverX0));</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  theta02 *= theta02 * inverseTotalMomentum2 * pathLengthOverX0;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordtype">double</span> varCoor = (x0 &gt; 0.) ? signedPathLength * signedPathLength * theta02 / 3. : 0.;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordtype">double</span> varSlop = theta02;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordtype">double</span> covCorrSlope = (x0 &gt; 0.) ? signedPathLength * theta02 / 2. : 0.;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">// Set MCS covariance matrix</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  TMatrixD newParamCov(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ab125dbb11ccb6f40a01a34691741cb70">getCovariances</a>());</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">// Non bending plane</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  newParamCov(0, 0) += varCoor;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  newParamCov(0, 1) += covCorrSlope;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  newParamCov(1, 0) += covCorrSlope;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  newParamCov(1, 1) += varSlop;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">// Bending plane</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  newParamCov(2, 2) += varCoor;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  newParamCov(2, 3) += covCorrSlope;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  newParamCov(3, 2) += covCorrSlope;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  newParamCov(3, 3) += varSlop;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// Set momentum related covariances if B!=0</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">if</span> (sFieldON) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">// compute derivative d(q/Pxy) / dSlopeX and d(q/Pxy) / dSlopeY</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordtype">double</span> dqPxydSlopeX =</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      inverseBendingMomentum * nonBendingSlope / (1. + nonBendingSlope * nonBendingSlope + bendingSlope * bendingSlope);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">double</span> dqPxydSlopeY = -inverseBendingMomentum * nonBendingSlope * nonBendingSlope * bendingSlope /</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                          (1. + bendingSlope * bendingSlope) /</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                          (1. + nonBendingSlope * nonBendingSlope + bendingSlope * bendingSlope);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// Inverse bending momentum (due to dependences with bending and non bending slopes)</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    newParamCov(4, 0) += dqPxydSlopeX * covCorrSlope;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    newParamCov(0, 4) += dqPxydSlopeX * covCorrSlope;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    newParamCov(4, 1) += dqPxydSlopeX * varSlop;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    newParamCov(1, 4) += dqPxydSlopeX * varSlop;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    newParamCov(4, 2) += dqPxydSlopeY * covCorrSlope;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    newParamCov(2, 4) += dqPxydSlopeY * covCorrSlope;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    newParamCov(4, 3) += dqPxydSlopeY * varSlop;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    newParamCov(3, 4) += dqPxydSlopeY * varSlop;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    newParamCov(4, 4) += (dqPxydSlopeX * dqPxydSlopeX + dqPxydSlopeY * dqPxydSlopeY) * varSlop;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">// Set new covariances</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">setCovariances</a>(newParamCov);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;}</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="keywordtype">void</span> TrackExtrap::convertTrackParamForExtrap(<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam, <span class="keywordtype">double</span> forwardBackward, <span class="keywordtype">double</span>* <a class="code" href="../../dc/da3/glcorearb_8h.html#ac2343f93cabb4191bf67057b0d22167c">v3</a>)</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  v3[0] = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a737deb142ad46bc08af58b4963a8f527">getNonBendingCoor</a>(); <span class="comment">// X</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  v3[1] = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a5cb1a7806fe3bbe43133b9e7472bd441">getBendingCoor</a>();    <span class="comment">// Y</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  v3[2] = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>();              <span class="comment">// Z</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordtype">double</span> pYZ = TMath::Abs(1.0 / trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a519bf955b6adb701214cf7bc8167598e">getInverseBendingMomentum</a>());</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordtype">double</span> pZ = pYZ / TMath::Sqrt(1.0 + trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>() * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>());</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  v3[6] = TMath::Sqrt(pYZ * pYZ + pZ * pZ * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>() * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>()); <span class="comment">// P</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  v3[5] = -forwardBackward * pZ / v3[6];                                                                          <span class="comment">// PZ/P spectro. z&lt;0</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  v3[3] = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>() * v3[5];                                                               <span class="comment">// PX/P</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  v3[4] = trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>() * v3[5];                                                                  <span class="comment">// PY/P</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keywordtype">void</span> TrackExtrap::recoverTrackParam(<span class="keywordtype">double</span>* v3, <span class="keywordtype">double</span> charge, <a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;{</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">setNonBendingCoor</a>(v3[0]); <span class="comment">// X</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">setBendingCoor</a>(v3[1]);    <span class="comment">// Y</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a13423cb6b35af04303a6b18bae9f597b">setZ</a>(v3[2]);              <span class="comment">// Z</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordtype">double</span> pYZ = v3[6] * TMath::Sqrt((1. - v3[3]) * (1. + v3[3]));</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7845c105d3d46f0c4c31ec6dfea154b2">setInverseBendingMomentum</a>(charge / pYZ);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a15fb665a79024f2e0653a4cb3b94d068">setBendingSlope</a>(v3[4] / v3[5]);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a31171def877b3bf1a6c62fabe8606a32">setNonBendingSlope</a>(v3[3] / v3[5]);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="keywordtype">bool</span> TrackExtrap::extrapToZRungekutta(<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam, <span class="keywordtype">double</span> zEnd)</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;{</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>() == zEnd) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// nothing to be done if same Z</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordtype">double</span> forwardBackward; <span class="comment">// +1 if forward, -1 if backward</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">if</span> (zEnd &lt; trackParam-&gt;getZ()) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    forwardBackward = 1.0; <span class="comment">// spectro. z&lt;0</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    forwardBackward = -1.0;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">// sign of charge (sign of fInverseBendingMomentum if forward motion)</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">// must be changed if backward extrapolation</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordtype">double</span> chargeExtrap = forwardBackward * TMath::Sign(<span class="keywordtype">double</span>(1.0), trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a519bf955b6adb701214cf7bc8167598e">getInverseBendingMomentum</a>());</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordtype">double</span> v3[7] = {0.}, v3New[7] = {0.};</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordtype">double</span> dZ(0.), step(0.);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">int</span> stepNumber = 0;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// Extrapolation loop (until within tolerance or the track turn around)</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">double</span> residue = zEnd - trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordflow">while</span> (TMath::Abs(residue) &gt; SRungeKuttaMaxResidue) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    dZ = zEnd - trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>();</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">// step length assuming linear trajectory</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    step = dZ * TMath::Sqrt(1.0 + trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>() * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>() +</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                            trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>() * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>());</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    convertTrackParamForExtrap(trackParam, forwardBackward, v3);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">do</span> { <span class="comment">// reduce step length while zEnd overstepped</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordflow">if</span> (++stepNumber &gt; SMaxStepNumber) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;Too many trials&quot;</span>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      step = TMath::Abs(step);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keywordflow">if</span> (!extrapOneStepRungekutta(chargeExtrap, step, v3, v3New)) {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      residue = zEnd - v3New[2];</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      step *= dZ / (v3New[2] - trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>());</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    } <span class="keywordflow">while</span> (residue * dZ &lt; 0 &amp;&amp; TMath::Abs(residue) &gt; SRungeKuttaMaxResidue);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (v3New[5] * v3[5] &lt; 0) { <span class="comment">// the track turned around</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;The track turned around&quot;</span>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    recoverTrackParam(v3New, chargeExtrap * forwardBackward, trackParam);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="comment">// terminate the extropolation with a straight line up to the exact &quot;zEnd&quot; value</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">setNonBendingCoor</a>(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a737deb142ad46bc08af58b4963a8f527">getNonBendingCoor</a>() + residue * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>());</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">setBendingCoor</a>(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a5cb1a7806fe3bbe43133b9e7472bd441">getBendingCoor</a>() + residue * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>());</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a13423cb6b35af04303a6b18bae9f597b">setZ</a>(zEnd);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="keywordtype">bool</span> TrackExtrap::extrapToZRungekuttaV2(<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">TrackParam</a>* trackParam, <span class="keywordtype">double</span> zEnd)</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;{</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">if</span> (trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>() == zEnd) {</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// nothing to be done if same Z</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  }</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordtype">double</span> residue = zEnd - trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">getZ</a>();</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordtype">double</span> forwardBackward = (residue &lt; 0) ? 1. : -1.; <span class="comment">// +1 if forward, -1 if backward</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordtype">double</span> v3[7] = {0.};</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  convertTrackParamForExtrap(trackParam, forwardBackward, v3);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordtype">double</span> charge = TMath::Sign(<span class="keywordtype">double</span>(1.), trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a519bf955b6adb701214cf7bc8167598e">getInverseBendingMomentum</a>());</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="comment">// Extrapolation loop (until within tolerance or the track turn around)</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordtype">double</span> v3New[7] = {0.};</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordtype">int</span> stepNumber = 0;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span> (++stepNumber &gt; SMaxStepNumber) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;Too many trials&quot;</span>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    }</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">// step length assuming linear trajectory</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">double</span> slopeX = v3[3] / v3[5];</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">double</span> slopeY = v3[4] / v3[5];</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordtype">double</span> step = TMath::Abs(residue) * TMath::Sqrt(1.0 + slopeX * slopeX + slopeY * slopeY);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">if</span> (!extrapOneStepRungekutta(forwardBackward * charge, step, v3, v3New)) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> (v3New[5] * v3[5] &lt; 0) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;The track turned around&quot;</span>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    residue = zEnd - v3New[2];</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">if</span> (TMath::Abs(residue) &lt; SRungeKuttaMaxResidueV2) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 7; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      v3[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = v3New[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// invert the sens of propagation if the track went too far</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (forwardBackward * residue &gt; 0) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      forwardBackward = -forwardBackward;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      v3[3] = -v3[3];</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      v3[4] = -v3[4];</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      v3[5] = -v3[5];</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  recoverTrackParam(v3New, charge, trackParam);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">// terminate the extrapolation with a straight line up to the exact &quot;zEnd&quot; value</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">setNonBendingCoor</a>(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a737deb142ad46bc08af58b4963a8f527">getNonBendingCoor</a>() + residue * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">getNonBendingSlope</a>());</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">setBendingCoor</a>(trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a5cb1a7806fe3bbe43133b9e7472bd441">getBendingCoor</a>() + residue * trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">getBendingSlope</a>());</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  trackParam-&gt;<a class="code" href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a13423cb6b35af04303a6b18bae9f597b">setZ</a>(zEnd);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="keywordtype">bool</span> TrackExtrap::extrapOneStepRungekutta(<span class="keywordtype">double</span> charge, <span class="keywordtype">double</span> step, <span class="keyword">const</span> <span class="keywordtype">double</span>* vect, <span class="keywordtype">double</span>* vout)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;{</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordtype">double</span> h2(0.), h4(0.), <a class="code" href="../../d4/dc3/classfloat.html">f</a>[4] = {0.};</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordtype">double</span> xyzt[3] = {FLT_MAX, FLT_MAX, FLT_MAX};</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>(0.), <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>(0.), <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a>(0.), ph(0.), ph2(0.);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordtype">double</span> secxs[4] = {0.}, secys[4] = {0.}, seczs[4] = {0.}, hxp[3] = {0.};</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordtype">double</span> g1(0.), g2(0.), g3(0.), g4(0.), g5(0.), g6(0.), ang2(0.), dxt(0.), dyt(0.), dzt(0.);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordtype">double</span> est(0.), at(0.), bt(0.), ct(0.), cba(0.);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordtype">double</span> f1(0.), f2(0.), f3(0.), f4(0.), rho(0.), tet(0.), hnorm(0.), hp(0.), rho1(0.), sint(0.), cost(0.);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>(0.);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>(0.);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>(0.);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordtype">double</span> xt(0.);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordtype">double</span> yt(0.);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordtype">double</span> zt(0.);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordtype">double</span> maxit = 1992;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keywordtype">double</span> maxcut = 11;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kdlt = 1<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a54fa239ec5d1c2872f1b6647509772ec">e</a>-4;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kdlt32 = kdlt / 32.;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kthird = 1. / 3.;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> khalf = 0.5;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kec = 2.9979251e-4;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kpisqua = 9.86960440109;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> kix = 0;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> kiy = 1;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> kiz = 2;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> kipx = 3;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> kipy = 4;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> kipz = 5;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="comment">// *.</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">// *.    ------------------------------------------------------------------</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="comment">// *.</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="comment">// *             this constant is for units cm,gev/c and kgauss</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="comment">// *</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordtype">int</span> iter = 0;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordtype">int</span> ncut = 0;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 7; j++) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    vout[j] = vect[j];</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keywordtype">double</span> pinv = kec * charge / vect[6];</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordtype">double</span> tl = 0.;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a> = step;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordtype">double</span> rest(0.);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    rest = step - tl;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (TMath::Abs(h) &gt; TMath::Abs(rest)) {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      h = rest;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">// cmodif: call gufld(vout,f) changed into:</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    TGeoGlobalMagField::Instance()-&gt;Field(vout, f);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    ++sNCallField;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">// *</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">// *             start of integration</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">// *</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    x = vout[0];</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    y = vout[1];</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    z = vout[2];</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> = vout[3];</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> = vout[4];</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> = vout[5];</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    h2 = khalf * <a class="code" href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    h4 = khalf * h2;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    ph = pinv * <a class="code" href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    ph2 = khalf * ph;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    secxs[0] = (<a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> * f[2] - <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> * f[1]) * ph2;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    secys[0] = (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> * f[0] - <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> * f[2]) * ph2;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    seczs[0] = (<a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> * f[1] - <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> * f[0]) * ph2;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    ang2 = (secxs[0] * secxs[0] + secys[0] * secys[0] + seczs[0] * seczs[0]);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span> (ang2 &gt; kpisqua) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    dxt = h2 * <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + h4 * secxs[0];</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    dyt = h2 * <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> + h4 * secys[0];</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    dzt = h2 * <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> + h4 * seczs[0];</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    xt = x + dxt;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    yt = y + dyt;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    zt = z + dzt;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">// *</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">// *              second intermediate point</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">// *</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    est = TMath::Abs(dxt) + TMath::Abs(dyt) + TMath::Abs(dzt);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> (est &gt; h) {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">if</span> (ncut++ &gt; maxcut) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      h *= khalf;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    xyzt[0] = xt;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    xyzt[1] = yt;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    xyzt[2] = zt;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">// cmodif: call gufld(xyzt,f) changed into:</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    TGeoGlobalMagField::Instance()-&gt;Field(xyzt, f);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    ++sNCallField;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    at = <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + secxs[0];</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    bt = <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> + secys[0];</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    ct = <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> + seczs[0];</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    secxs[1] = (bt * f[2] - ct * f[1]) * ph2;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    secys[1] = (ct * f[0] - at * f[2]) * ph2;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    seczs[1] = (at * f[1] - bt * f[0]) * ph2;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    at = <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + secxs[1];</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    bt = <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> + secys[1];</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    ct = <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> + seczs[1];</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    secxs[2] = (bt * f[2] - ct * f[1]) * ph2;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    secys[2] = (ct * f[0] - at * f[2]) * ph2;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    seczs[2] = (at * f[1] - bt * f[0]) * ph2;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    dxt = h * (<a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + secxs[2]);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    dyt = h * (<a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> + secys[2]);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    dzt = h * (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> + seczs[2]);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    xt = x + dxt;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    yt = y + dyt;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    zt = z + dzt;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    at = <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + 2. * secxs[2];</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    bt = <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> + 2. * secys[2];</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    ct = <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> + 2. * seczs[2];</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    est = TMath::Abs(dxt) + TMath::Abs(dyt) + TMath::Abs(dzt);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">if</span> (est &gt; 2. * TMath::Abs(h)) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">if</span> (ncut++ &gt; maxcut) {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      h *= khalf;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    xyzt[0] = xt;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    xyzt[1] = yt;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    xyzt[2] = zt;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="comment">// cmodif: call gufld(xyzt,f) changed into:</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    TGeoGlobalMagField::Instance()-&gt;Field(xyzt, f);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    ++sNCallField;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    z = z + (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> + (seczs[0] + seczs[1] + seczs[2]) * kthird) * <a class="code" href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a>;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    y = y + (<a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> + (secys[0] + secys[1] + secys[2]) * kthird) * <a class="code" href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    x = x + (<a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + (secxs[0] + secxs[1] + secxs[2]) * kthird) * <a class="code" href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a>;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    secxs[3] = (bt * f[2] - ct * f[1]) * ph2;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    secys[3] = (ct * f[0] - at * f[2]) * ph2;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    seczs[3] = (at * f[1] - bt * f[0]) * ph2;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> = <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + (secxs[0] + secxs[3] + 2. * (secxs[1] + secxs[2])) * kthird;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> = <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> + (secys[0] + secys[3] + 2. * (secys[1] + secys[2])) * kthird;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> = <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> + (seczs[0] + seczs[3] + 2. * (seczs[1] + seczs[2])) * kthird;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    est = TMath::Abs(secxs[0] + secxs[3] - (secxs[1] + secxs[2])) +</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;          TMath::Abs(secys[0] + secys[3] - (secys[1] + secys[2])) +</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          TMath::Abs(seczs[0] + seczs[3] - (seczs[1] + seczs[2]));</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span> (est &gt; kdlt &amp;&amp; TMath::Abs(h) &gt; 1.<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a54fa239ec5d1c2872f1b6647509772ec">e</a>-4) {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">if</span> (ncut++ &gt; maxcut) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      h *= khalf;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    ncut = 0;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">// *               if too many iterations, go to helix</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">if</span> (iter++ &gt; maxit) {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    tl += <a class="code" href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">if</span> (est &lt; kdlt32) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      h *= 2.;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    cba = 1. / TMath::Sqrt(<a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> * <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a> + <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> * <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a> + <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a> * <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a>);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    vout[0] = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    vout[1] = <a class="code" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    vout[2] = <a class="code" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    vout[3] = cba * <a class="code" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    vout[4] = cba * <a class="code" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    vout[5] = cba * <a class="code" href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a>;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    rest = step - tl;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span> (step &lt; 0.) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      rest = -rest;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keywordflow">if</span> (rest &lt; 1.<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a54fa239ec5d1c2872f1b6647509772ec">e</a>-5 * TMath::Abs(step)) {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    }</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  } <span class="keywordflow">while</span> (1);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="comment">// angle too big, use helix</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;Ruge-Kutta failed: switch to helix&quot;</span>;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  f1 = f[0];</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  f2 = f[1];</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  f3 = f[2];</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  f4 = TMath::Sqrt(f1 * f1 + f2 * f2 + f3 * f3);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">if</span> (f4 &lt; 1.<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a54fa239ec5d1c2872f1b6647509772ec">e</a>-10) {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(WARNING) &lt;&lt; <span class="stringliteral">&quot;magnetic field at (&quot;</span> &lt;&lt; xyzt[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; xyzt[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; xyzt[2] &lt;&lt; <span class="stringliteral">&quot;) = &quot;</span> &lt;&lt; f4 &lt;&lt; <span class="stringliteral">&quot;: giving up&quot;</span>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  rho = -f4 * pinv;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  tet = rho * step;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  hnorm = 1. / f4;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  f1 = f1 * hnorm;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  f2 = f2 * hnorm;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  f3 = f3 * hnorm;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  hxp[0] = f2 * vect[kipz] - f3 * vect[kipy];</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  hxp[1] = f3 * vect[kipx] - f1 * vect[kipz];</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  hxp[2] = f1 * vect[kipy] - f2 * vect[kipx];</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  hp = f1 * vect[kipx] + f2 * vect[kipy] + f3 * vect[kipz];</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  rho1 = 1. / rho;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  sint = TMath::Sin(tet);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  cost = 2. * TMath::Sin(khalf * tet) * TMath::Sin(khalf * tet);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  g1 = sint * rho1;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  g2 = cost * rho1;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  g3 = (tet - sint) * hp * rho1;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  g4 = -cost;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  g5 = sint;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  g6 = cost * hp;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  vout[kix] = vect[kix] + g1 * vect[kipx] + g2 * hxp[0] + g3 * f1;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  vout[kiy] = vect[kiy] + g1 * vect[kipy] + g2 * hxp[1] + g3 * f2;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  vout[kiz] = vect[kiz] + g1 * vect[kipz] + g2 * hxp[2] + g3 * f3;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  vout[kipx] = vect[kipx] + g4 * vect[kipx] + g5 * hxp[0] + g6 * f1;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  vout[kipy] = vect[kipy] + g4 * vect[kipy] + g5 * hxp[1] + g6 * f2;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  vout[kipz] = vect[kipz] + g4 * vect[kipz] + g5 * hxp[2] + g6 * f3;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;}</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">//__________________________________________________________________________</span></div><div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ad705e1fd1795b9429ed58b6cff35ea50">  765</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ad705e1fd1795b9429ed58b6cff35ea50">TrackExtrap::printNCalls</a>()</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;{</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;number of times extrapToZCov() is called = &quot;</span> &lt;&lt; sNCallExtrapToZCov;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;number of times Field() is called = &quot;</span> &lt;&lt; sNCallField;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;} <span class="comment">// namespace mch</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;} <span class="comment">// namespace o2</span></div><div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ad9293dcfa472efd774399f27c3b252f0"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ad9293dcfa472efd774399f27c3b252f0">o2::mch::TrackParam::getBendingSlope</a></div><div class="ttdeci">Double_t getBendingSlope() const </div><div class="ttdoc">return bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00059">TrackParam.h:59</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a9259594095566d334237e27c0aa54553"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9259594095566d334237e27c0aa54553">o2::mch::TrackParam::getZ</a></div><div class="ttdeci">Double_t getZ() const </div><div class="ttdoc">return Z coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00043">TrackParam.h:43</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ac7c896d55e93a6cf7ff8524005b4e7b4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac7c896d55e93a6cf7ff8524005b4e7b4">param</a></div><div class="ttdeci">GLenum GLfloat param</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00272">glcorearb.h:272</a></div></div>
<div class="ttc" id="namespaceo2_html"><div class="ttname"><a href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="ttdoc">a couple of static helper functions to create timestamp values for CCDB queries </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d24/BitstreamReader_8h_source.html#l00022">BitstreamReader.h:22</a></div></div>
<div class="ttc" id="glcorearb_8h_html_aee38b51639b577753f6a92029fb92000"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a></div><div class="ttdeci">GLdouble GLdouble GLdouble z</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00845">glcorearb.h:845</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a6a38a16a9b79f77e515a8c3b76eebdd7"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6a38a16a9b79f77e515a8c3b76eebdd7">o2::mch::TrackExtrap::linearExtrapToZCov</a></div><div class="ttdeci">static void linearExtrapToZCov(TrackParam *trackParam, double zEnd, bool updatePropagator=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00100">TrackExtrap.cxx:100</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_ab125dbb11ccb6f40a01a34691741cb70"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#ab125dbb11ccb6f40a01a34691741cb70">o2::mch::TrackParam::getCovariances</a></div><div class="ttdeci">const TMatrixD &amp; getCovariances() const </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00191">TrackParam.cxx:191</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_afcf7aeb373f274c8c3c1e53ce5ab242a"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#afcf7aeb373f274c8c3c1e53ce5ab242a">o2::mch::TrackParam::setNonBendingCoor</a></div><div class="ttdeci">void setNonBendingCoor(Double_t nonBendingCoor)</div><div class="ttdoc">set non bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00049">TrackParam.h:49</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a54d02ff485fc6a60973d0fd9f51a5616"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a54d02ff485fc6a60973d0fd9f51a5616">o2::mch::TrackParam::getParameters</a></div><div class="ttdeci">const TMatrixD &amp; getParameters() const </div><div class="ttdoc">return track parameters </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00076">TrackParam.h:76</a></div></div>
<div class="ttc" id="GPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00025">GPUCommonLogger.h:25</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a3a666dd94c87147dbde312166c9ba6a0"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a3a666dd94c87147dbde312166c9ba6a0">o2::mch::TrackParam::hasCovariances</a></div><div class="ttdeci">Bool_t hasCovariances() const </div><div class="ttdoc">return kTRUE if the covariance matrix exist, kFALSE if not </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00088">TrackParam.h:88</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_af3a03bdc4c1fce56d5e8b10a69e6a233"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#af3a03bdc4c1fce56d5e8b10a69e6a233">o2::mch::TrackExtrap::addMCSEffect</a></div><div class="ttdeci">static void addMCSEffect(TrackParam *trackParam, double dZ, double x0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00269">TrackExtrap.cxx:269</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ac8729153468b5dcf13f971b21d84d4e5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a></div><div class="ttdeci">GLboolean GLboolean GLboolean GLboolean a</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01235">glcorearb.h:1235</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a4fd54f6fd209ed9abe259d6f4bd9c555"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a4fd54f6fd209ed9abe259d6f4bd9c555">o2::mch::TrackExtrap::getMCSAngle2</a></div><div class="ttdeci">static double getMCSAngle2(const TrackParam &amp;param, double dZ, double x0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00248">TrackExtrap.cxx:248</a></div></div>
<div class="ttc" id="glcorearb_8h_html_ac2343f93cabb4191bf67057b0d22167c"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac2343f93cabb4191bf67057b0d22167c">v3</a></div><div class="ttdeci">GLfloat GLfloat GLfloat GLfloat v3</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00816">glcorearb.h:816</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_aac63a415ff843e903851611bb8e2df79"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#aac63a415ff843e903851611bb8e2df79">o2::mch::TrackExtrap::extrapToZCov</a></div><div class="ttdeci">static bool extrapToZCov(TrackParam *trackParam, double zEnd, bool updatePropagator=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00156">TrackExtrap.cxx:156</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a9f04bd9911b4abbc19de20edbcd89d64"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a9f04bd9911b4abbc19de20edbcd89d64">o2::mch::TrackParam::setBendingCoor</a></div><div class="ttdeci">void setBendingCoor(Double_t bendingCoor)</div><div class="ttdoc">set bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00057">TrackParam.h:57</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_aba28923af349ff2ec356d00c8b46dcb4"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aba28923af349ff2ec356d00c8b46dcb4">o2::mch::TrackParam::setParameters</a></div><div class="ttdeci">void setParameters(const TMatrixD &amp;parameters)</div><div class="ttdoc">set track parameters </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00078">TrackParam.h:78</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a15fb665a79024f2e0653a4cb3b94d068"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a15fb665a79024f2e0653a4cb3b94d068">o2::mch::TrackParam::setBendingSlope</a></div><div class="ttdeci">void setBendingSlope(Double_t bendingSlope)</div><div class="ttdoc">set bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00061">TrackParam.h:61</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_ad705e1fd1795b9429ed58b6cff35ea50"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#ad705e1fd1795b9429ed58b6cff35ea50">o2::mch::TrackExtrap::printNCalls</a></div><div class="ttdeci">static void printNCalls()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00765">TrackExtrap.cxx:765</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_adaa09ecf68637a4523743f5fb2aca2c8"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#adaa09ecf68637a4523743f5fb2aca2c8">o2::mch::TrackExtrap::linearExtrapToZ</a></div><div class="ttdeci">static void linearExtrapToZ(TrackParam *trackParam, double zEnd)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00083">TrackExtrap.cxx:83</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_aece9d813f2d8a99c5680c9a9cd66b3de"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#aece9d813f2d8a99c5680c9a9cd66b3de">o2::mch::TrackParam::getNonBendingSlope</a></div><div class="ttdeci">Double_t getNonBendingSlope() const </div><div class="ttdoc">return non bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00051">TrackParam.h:51</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a8fad63ea683004a4d6de4348ba26df7d"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a8fad63ea683004a4d6de4348ba26df7d">o2::mch::TrackParam::setCovariances</a></div><div class="ttdeci">void setCovariances(const TMatrixD &amp;covariances)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00202">TrackParam.cxx:202</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_acf3acff66b783f10a36a67d8c36f1bcd"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#acf3acff66b783f10a36a67d8c36f1bcd">o2::mch::TrackExtrap::getImpactParamFromBendingMomentum</a></div><div class="ttdeci">static double getImpactParamFromBendingMomentum(double bendingMomentum)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00051">TrackExtrap.cxx:51</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a6dc7af2f47ff1263047e41a5ef9ddc7b"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a6dc7af2f47ff1263047e41a5ef9ddc7b">o2::mch::TrackParam::addParameters</a></div><div class="ttdeci">void addParameters(const TMatrixD &amp;parameters)</div><div class="ttdoc">add track parameters </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00080">TrackParam.h:80</a></div></div>
<div class="ttc" id="TrackParam_8h_html"><div class="ttname"><a href="../../de/d4b/TrackParam_8h.html">TrackParam.h</a></div><div class="ttdoc">Definition of the MCH track parameters for internal use. </div></div>
<div class="ttc" id="classfloat_html"><div class="ttname"><a href="../../d4/dc3/classfloat.html">float</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a13423cb6b35af04303a6b18bae9f597b"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a13423cb6b35af04303a6b18bae9f597b">o2::mch::TrackParam::setZ</a></div><div class="ttdeci">void setZ(Double_t z)</div><div class="ttdoc">set Z coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00045">TrackParam.h:45</a></div></div>
<div class="ttc" id="TrackExtrap_8h_html"><div class="ttname"><a href="../../d8/d9c/TrackExtrap_8h.html">TrackExtrap.h</a></div><div class="ttdoc">Definition of tools for track extrapolation. </div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a31171def877b3bf1a6c62fabe8606a32"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a31171def877b3bf1a6c62fabe8606a32">o2::mch::TrackParam::setNonBendingSlope</a></div><div class="ttdeci">void setNonBendingSlope(Double_t nonBendingSlope)</div><div class="ttdoc">set non bending slope (cm ** -1) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00053">TrackParam.h:53</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a8f1273bfdd614c2336509e4ec4395d62"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a8f1273bfdd614c2336509e4ec4395d62">o2::mch::TrackExtrap::extrapToZ</a></div><div class="ttdeci">static bool extrapToZ(TrackParam *trackParam, double zEnd)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00141">TrackExtrap.cxx:141</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a6eba317e3cf44d6d26c04a5a8f197dcb"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a></div><div class="ttdeci">GLboolean GLboolean GLboolean b</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01235">glcorearb.h:1235</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a3820068e4ae7e7b3c7a0a668d40e21e1"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a3820068e4ae7e7b3c7a0a668d40e21e1">o2::mch::TrackExtrap::setField</a></div><div class="ttdeci">static void setField()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00038">TrackExtrap.cxx:38</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a7845c105d3d46f0c4c31ec6dfea154b2"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a7845c105d3d46f0c4c31ec6dfea154b2">o2::mch::TrackParam::setInverseBendingMomentum</a></div><div class="ttdeci">void setInverseBendingMomentum(Double_t inverseBendingMomentum)</div><div class="ttdoc">set inverse bending momentum (GeV/c ** -1) times the charge (assumed forward motion) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00065">TrackParam.h:65</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a54fa239ec5d1c2872f1b6647509772ec"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a54fa239ec5d1c2872f1b6647509772ec">e</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events Simulate correct bunch interactions instead of placing only the average number of events A value[n] sets TFlen for[n] collisions in Number of bunches per train Number of bunch trains Instantaneous interaction rate Do not simulate border Total number of collisions to be placed in the interior of all time Do not select random but walk over array of events in stride steps h QA settings const char Legend entries for data from comparison histogram files const char Store histograms in output root Do not run but just create PDFs from input root files Set cut for Q Compute the efficiency including impure tracks with fake contamination Maxmimum Create resolution histograms in the native fit Filter for Filter for Particle Store mc labels to file for later matching Minimum Pt of a matched track to be displayed Compare QA QAonly Event generator settings h Reconstruction settings Enable TRD processing Enable TPC Compression Mask to disable certain attachment steps during refit Pt threshold to reject clusters of TPC tracks Sort order of TPC Force early TPC transformation also for continuous Forward TPC digits as h Processing settings Run tracklet constructor in pipeline Bitmask for RecoSteps h configStandalone Use CPU for const char GPU Force usage of the specified GPU device no CPU fallback Allow only GPU as OpenCL device Do prompt for keypress before Continue processing after an error Use device timers instead of host based time measurement Clear debug output file when processing next event First event to Number of events to Run track merging Number of iterations to Number of iterations to Number of initial iterations excluded from const char e</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00128">qconfigoptions.h:128</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a98ac434677655cc8438bb72de2719f39"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a98ac434677655cc8438bb72de2719f39">x0</a></div><div class="ttdeci">GLuint GLfloat x0</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l04882">glcorearb.h:4882</a></div></div>
<div class="ttc" id="glcorearb_8h_html_afa0fb1b5e976920c0abeff2dca3ed774"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a></div><div class="ttdeci">GLfloat GLfloat GLfloat GLfloat h</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l02017">glcorearb.h:2017</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a5cb1a7806fe3bbe43133b9e7472bd441"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a5cb1a7806fe3bbe43133b9e7472bd441">o2::mch::TrackParam::getBendingCoor</a></div><div class="ttdeci">Double_t getBendingCoor() const </div><div class="ttdoc">return bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00055">TrackParam.h:55</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackExtrap_html_a6e00e7ed1cba587512308463c62edd52"><div class="ttname"><a href="../../d5/d6f/classo2_1_1mch_1_1TrackExtrap.html#a6e00e7ed1cba587512308463c62edd52">o2::mch::TrackExtrap::getBendingMomentumFromImpactParam</a></div><div class="ttdeci">static double getBendingMomentumFromImpactParam(double impactParam)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/deb/TrackExtrap_8cxx_source.html#l00065">TrackExtrap.cxx:65</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a737deb142ad46bc08af58b4963a8f527"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a737deb142ad46bc08af58b4963a8f527">o2::mch::TrackParam::getNonBendingCoor</a></div><div class="ttdeci">Double_t getNonBendingCoor() const </div><div class="ttdoc">return non bending coordinate (cm) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00047">TrackParam.h:47</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_af50954f6efd5209b2328d33cd185f87e"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#af50954f6efd5209b2328d33cd185f87e">c</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events Simulate correct bunch interactions instead of placing only the average number of events A value[n] sets TFlen for[n] collisions in Number of bunches per train Number of bunch trains Instantaneous interaction rate Do not simulate border Total number of collisions to be placed in the interior of all time Do not select random but walk over array of events in stride steps h QA settings const char Legend entries for data from comparison histogram files const char Store histograms in output root Do not run but just create PDFs from input root files Set cut for Q Compute the efficiency including impure tracks with fake contamination Maxmimum Create resolution histograms in the native fit Filter for Filter for Particle Store mc labels to file for later matching Minimum Pt of a matched track to be displayed Compare QA QAonly Event generator settings h Reconstruction settings Enable TRD processing Enable TPC Compression Mask to disable certain attachment steps during refit Pt threshold to reject clusters of TPC tracks Sort order of TPC Force early TPC transformation also for continuous Forward TPC digits as h Processing settings Run tracklet constructor in pipeline Bitmask for RecoSteps h configStandalone c</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00099">qconfigoptions.h:99</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a0cdec8e97a75ee9458b23d152bf962d4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a></div><div class="ttdeci">GLint GLenum GLint x</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00404">glcorearb.h:404</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_a519bf955b6adb701214cf7bc8167598e"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#a519bf955b6adb701214cf7bc8167598e">o2::mch::TrackParam::getInverseBendingMomentum</a></div><div class="ttdeci">Double_t getInverseBendingMomentum() const </div><div class="ttdoc">return inverse bending momentum (GeV/c ** -1) times the charge (assumed forward motion) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00063">TrackParam.h:63</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a74d80fd479c0f6d0153c709949a089ef"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a></div><div class="ttdeci">GLint y</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00271">glcorearb.h:271</a></div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00312">GPUCommonAlgorithm.h:312</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html_acc74ea7901f760fb2815a62b28c8fdc7"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html#acc74ea7901f760fb2815a62b28c8fdc7">o2::mch::TrackParam::updatePropagator</a></div><div class="ttdeci">void updatePropagator(const TMatrixD &amp;propagator)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d16/TrackParam_8cxx_source.html#l00259">TrackParam.cxx:259</a></div></div>
<div class="ttc" id="classo2_1_1mch_1_1TrackParam_html"><div class="ttname"><a href="../../d6/d0f/classo2_1_1mch_1_1TrackParam.html">o2::mch::TrackParam</a></div><div class="ttdoc">track parameters for internal use </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4b/TrackParam_8h_source.html#l00031">TrackParam.h:31</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_1cc233fd3b1202b9dad36810b41b97af.html">MUON</a></li><li class="navelem"><a class="el" href="../../dir_061f7088060f41729027f6c2fce0273e.html">MCH</a></li><li class="navelem"><a class="el" href="../../dir_09445408fa345a18838fb91740d089d0.html">Tracking</a></li><li class="navelem"><a class="el" href="../../dir_f33357dc4b90b7dfe5d72abda619e77f.html">src</a></li><li class="navelem"><a class="el" href="../../d2/deb/TrackExtrap_8cxx.html">TrackExtrap.cxx</a></li>
    <li class="footer">Generated on Wed Dec 11 2019 10:27:52 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
